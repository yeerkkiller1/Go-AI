<html>

<!-- Mirrored from fuego.sourceforge.net/fuego-doc-1.1/gouct-doc/GoUctSearch_8cpp_source.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 25 Apr 2012 18:02:59 GMT -->
<head>
<title>GoUct Library: GoUctSearch.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body bgcolor="#ffffff">
<div class="qindex">
<a class="qindex" href="../main.html">Index</a> &nbsp;
<a class="qindex" href="index.html">Main</a> &nbsp;
<a class="qindex" href="namespaces.html">Namespaces</a> &nbsp;
<a class="qindex" href="classes.html">Classes</a> &nbsp;
<a class="qindex" href="hierarchy.html">Hierarchy</a> &nbsp;
<a class="qindex" href="annotated.html">Annotated</a> &nbsp;
<a class="qindex" href="files.html">Files</a> &nbsp;
<!--
<a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp;>
-->
<a class="qindex" href="functions.html">Compound</a> &nbsp;
<a class="qindex" href="globals.html">Global</a> &nbsp;
<a class="qindex" href="pages.html">Pages</a> &nbsp;
</div>
<!-- Generated by Doxygen 1.7.1 -->
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_464b6bcc88ca6131eae185e186ba0d4c.html">gouct</a>      </li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>GoUctSearch.cpp</h1>  </div>
</div>
<div class="contents">
<a href="GoUctSearch_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//----------------------------------------------------------------------------</span><span class="comment"></span>
<a name="l00002"></a>00002 <span class="comment">/** @file GoUctSearch.cpp */</span>
<a name="l00003"></a>00003 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgSystem_8h.html">SgSystem.h</a>&quot;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &quot;<a class="code" href="GoUctSearch_8h.html">GoUctSearch.h</a>&quot;</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/GoBoardUtil_8h.html">GoBoardUtil.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/GoNodeUtil_8h.html">GoNodeUtil.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="GoUctUtil_8h.html">GoUctUtil.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8h.html">SgDebug.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgGameWriter_8h.html">SgGameWriter.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgNode_8h.html">SgNode.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgUctTreeUtil_8h.html">SgUctTreeUtil.h</a>&quot;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="keyword">using namespace </span>std;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="keyword">namespace </span>{
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">const</span> <span class="keywordtype">int</span> MOVERANGE = <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgPoint_8h.html#a91bceaeaed14cc1ac24bec79532430e7">SG_PASS</a> + 1;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html">SgNode</a>* AppendChild(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html">SgNode</a>* node, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; comment)
<a name="l00029"></a>00029 {
<a name="l00030"></a>00030     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html">SgNode</a>* child = node-&gt;<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html#ac5c17fdaaeb837dcf0343c869eff81b9">NewRightMostSon</a>();
<a name="l00031"></a>00031     child-&gt;<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html#a3108b7a278aeee7af29a71373c1e8e7b">AddComment</a>(comment);
<a name="l00032"></a>00032     <span class="keywordflow">return</span> child;
<a name="l00033"></a>00033 }
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html">SgNode</a>* AppendChild(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html">SgNode</a>* node, <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgBlackWhite_8h.html#afd337f4ec449af4cfe657b21993d556d">SgBlackWhite</a> color, <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgPoint_8h.html#a49c23409e7e51c1edc053b56d3dd248c">SgPoint</a> move)
<a name="l00036"></a>00036 {
<a name="l00037"></a>00037     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html">SgNode</a>* child = node-&gt;<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html#ac5c17fdaaeb837dcf0343c869eff81b9">NewRightMostSon</a>();
<a name="l00038"></a>00038     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgProp_8h.html#ac87b8ad1c06b3c700fc52266b0617fa0">SgPropID</a> propId =
<a name="l00039"></a>00039         (color == <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgBlackWhite_8h.html#a455e66a4a6ccc0a446eb2d10814c93a5">SG_BLACK</a> ? <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgProp_8cpp.html#a0b2cf8a461963c70ec2b1b3d694e01d8">SG_PROP_MOVE_BLACK</a> : <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgProp_8cpp.html#a7c5fb59fd092cdb6d16896b40ebfd937">SG_PROP_MOVE_WHITE</a>);
<a name="l00040"></a>00040     child-&gt;<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html#a527680a7d2744614ec3a5f440af0e98e">Add</a>(<span class="keyword">new</span> <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgPropMove.html">SgPropMove</a>(propId, move));
<a name="l00041"></a>00041     <span class="keywordflow">return</span> child;
<a name="l00042"></a>00042 }
<a name="l00043"></a>00043 <span class="comment"></span>
<a name="l00044"></a>00044 <span class="comment">/** Append game to saved simulations (used if m_keepGames is true) */</span>
<a name="l00045"></a>00045 <span class="keywordtype">void</span> AppendGame(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html">SgNode</a>* node, <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgUctValue_8h.html#a14d2f4b164799cba5679f82158445cfa">SgUctValue</a> gameNumber, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> threadId,
<a name="l00046"></a>00046                 <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgBlackWhite_8h.html#afd337f4ec449af4cfe657b21993d556d">SgBlackWhite</a> toPlay, <span class="keyword">const</span> <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/structSgUctGameInfo.html">SgUctGameInfo</a>&amp; info)
<a name="l00047"></a>00047 {
<a name="l00048"></a>00048     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgSystem_8h.html#a558b618265a6c7bf8eed5bd947f3a64f">SG_ASSERT</a>(node != 0);
<a name="l00049"></a>00049     {
<a name="l00050"></a>00050         ostringstream comment;
<a name="l00051"></a>00051         comment &lt;&lt; <span class="stringliteral">&quot;Thread &quot;</span> &lt;&lt; threadId &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00052"></a>00052                 &lt;&lt; <span class="stringliteral">&quot;Game &quot;</span> &lt;&lt; gameNumber &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00053"></a>00053         node = AppendChild(node, comment.str());
<a name="l00054"></a>00054     }
<a name="l00055"></a>00055     <span class="keywordtype">size_t</span> nuMovesInTree = info.<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/structSgUctGameInfo.html#a9d35345bf62397bd4fc8bfce13b5982d">m_inTreeSequence</a>.size();
<a name="l00056"></a>00056     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; nuMovesInTree; ++i)
<a name="l00057"></a>00057     {
<a name="l00058"></a>00058         node = AppendChild(node, toPlay, info.<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/structSgUctGameInfo.html#a9d35345bf62397bd4fc8bfce13b5982d">m_inTreeSequence</a>[i]);
<a name="l00059"></a>00059         toPlay = <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgBlackWhite_8h.html#ad46e340d4ffa744bb5011cdb21991f80">SgOppBW</a>(toPlay);
<a name="l00060"></a>00060     }
<a name="l00061"></a>00061     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html">SgNode</a>* lastInTreeNode = node;
<a name="l00062"></a>00062     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgBlackWhite_8h.html#afd337f4ec449af4cfe657b21993d556d">SgBlackWhite</a> lastInTreeToPlay = toPlay;
<a name="l00063"></a>00063     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; info.<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/structSgUctGameInfo.html#a5c010f94ca1fbbe9fd7d7f4263e4eeee">m_eval</a>.size(); ++i)
<a name="l00064"></a>00064     {
<a name="l00065"></a>00065         node = lastInTreeNode;
<a name="l00066"></a>00066         toPlay = lastInTreeToPlay;
<a name="l00067"></a>00067         ostringstream comment;
<a name="l00068"></a>00068         comment &lt;&lt; <span class="stringliteral">&quot;Playout &quot;</span> &lt;&lt; i &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00069"></a>00069                 &lt;&lt; <span class="stringliteral">&quot;Eval &quot;</span> &lt;&lt; info.<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/structSgUctGameInfo.html#a5c010f94ca1fbbe9fd7d7f4263e4eeee">m_eval</a>[i] &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00070"></a>00070                 &lt;&lt; <span class="stringliteral">&quot;Aborted &quot;</span> &lt;&lt; info.<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/structSgUctGameInfo.html#a722102fcc6a67f902c90dec99f771e35">m_aborted</a>[i] &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00071"></a>00071         node = AppendChild(node, comment.str());
<a name="l00072"></a>00072         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = nuMovesInTree; j &lt; info.<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/structSgUctGameInfo.html#aab7e9073b91a71db108120023486ebb1">m_sequence</a>[i].size(); ++j)
<a name="l00073"></a>00073         {
<a name="l00074"></a>00074             node = AppendChild(node, toPlay, info.<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/structSgUctGameInfo.html#aab7e9073b91a71db108120023486ebb1">m_sequence</a>[i][j]);
<a name="l00075"></a>00075             toPlay = <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgBlackWhite_8h.html#ad46e340d4ffa744bb5011cdb21991f80">SgOppBW</a>(toPlay);
<a name="l00076"></a>00076         }
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078 }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 } <span class="comment">// namespace</span>
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="classGoUctState_1_1AssertionHandler.html#a5e22076ede7c23a877d1a437b65662f8">00086</a> <a class="code" href="classGoUctState_1_1AssertionHandler.html#a5e22076ede7c23a877d1a437b65662f8">GoUctState::AssertionHandler::AssertionHandler</a>(<span class="keyword">const</span> <a class="code" href="classGoUctState.html" title="Thread state for GoUctSearch.">GoUctState</a>&amp; state)
<a name="l00087"></a>00087     : m_state(state)
<a name="l00088"></a>00088 {
<a name="l00089"></a>00089 }
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="classGoUctState_1_1AssertionHandler.html#a853fbda08bc41b2d8e0636d36fdd3a9b">00091</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctState_1_1AssertionHandler.html#a853fbda08bc41b2d8e0636d36fdd3a9b">GoUctState::AssertionHandler::Run</a>()
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093     <a class="code" href="classGoUctState_1_1AssertionHandler.html#a32ca2fc955933f55df2dff174fac8c45">m_state</a>.<a class="code" href="classGoUctState.html#a021291ac3175a120c9dcb70e8bd1cb6b">Dump</a>(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8cpp.html#a4f7aef519ae8e6fcc1399ffee77dd85d">SgDebug</a>());
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="classGoUctState.html#a5324107577b322b487131fdcbdbfe7d0">00098</a> <a class="code" href="classGoUctState.html#a5324107577b322b487131fdcbdbfe7d0" title="Constructor.">GoUctState::GoUctState</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> threadId, <span class="keyword">const</span> <a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html">GoBoard</a>&amp; bd)
<a name="l00099"></a>00099     : <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctThreadState.html">SgUctThreadState</a>(threadId, MOVERANGE),
<a name="l00100"></a>00100       <a class="code" href="classGoUctState.html#a4c3d1f892a2ada24311f5eb875b1e359">m_assertionHandler</a>(*this),
<a name="l00101"></a>00101       <a class="code" href="classGoUctState.html#a0335d31b29d23b5b6e5927b90c4eb814" title="Board used for playout phase.">m_uctBd</a>(bd),
<a name="l00102"></a>00102       <a class="code" href="classGoUctState.html#a762102ef7b7b672d3d79f16b6476a12e">m_synchronizer</a>(bd)
<a name="l00103"></a>00103 {
<a name="l00104"></a>00104     <a class="code" href="classGoUctState.html#a762102ef7b7b672d3d79f16b6476a12e">m_synchronizer</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoardSynchronizer.html#ae143e8d2124c34b8b2bf7dc78171c032">SetSubscriber</a>(<a class="code" href="classGoUctState.html#aea9469fa8b353f891e4b0480f6d8495e" title="Board used for in-tree phase.">m_bd</a>);
<a name="l00105"></a>00105     <a class="code" href="classGoUctState.html#a2d07f27c64f730d613dd6a8532ecd815">m_isInPlayout</a> = <span class="keyword">false</span>;
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="classGoUctState.html#a021291ac3175a120c9dcb70e8bd1cb6b">00108</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctState.html#a021291ac3175a120c9dcb70e8bd1cb6b">GoUctState::Dump</a>(ostream&amp; out)<span class="keyword"> const</span>
<a name="l00109"></a>00109 <span class="keyword"></span>{
<a name="l00110"></a>00110     out &lt;&lt; <span class="stringliteral">&quot;GoUctState[&quot;</span> &lt;&lt; <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctThreadState.html#a941bf905ebff33786fd9162fd53ad683">m_threadId</a> &lt;&lt; <span class="stringliteral">&quot;] &quot;</span>;
<a name="l00111"></a>00111     <span class="keywordflow">if</span> (<a class="code" href="classGoUctState.html#a2d07f27c64f730d613dd6a8532ecd815">m_isInPlayout</a>)
<a name="l00112"></a>00112         out &lt;&lt; <span class="stringliteral">&quot;playout board:\n&quot;</span> &lt;&lt; <a class="code" href="classGoUctState.html#a0335d31b29d23b5b6e5927b90c4eb814" title="Board used for playout phase.">m_uctBd</a>;
<a name="l00113"></a>00113     <span class="keywordflow">else</span>
<a name="l00114"></a>00114         out &lt;&lt; <span class="stringliteral">&quot;board:\n&quot;</span> &lt;&lt; <a class="code" href="classGoUctState.html#aea9469fa8b353f891e4b0480f6d8495e" title="Board used for in-tree phase.">m_bd</a>;
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="classGoUctState.html#a2663b09b456e2261cf0368cac2c586b9">00117</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctState.html#a2663b09b456e2261cf0368cac2c586b9" title="Implementation of SgUctSearch::Execute.">GoUctState::Execute</a>(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgMove_8h.html#ab340c6de81d64e1ff03291b50925defa">SgMove</a> move)
<a name="l00118"></a>00118 {
<a name="l00119"></a>00119     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgSystem_8h.html#a558b618265a6c7bf8eed5bd947f3a64f">SG_ASSERT</a>(! <a class="code" href="classGoUctState.html#a2d07f27c64f730d613dd6a8532ecd815">m_isInPlayout</a>);
<a name="l00120"></a>00120     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgSystem_8h.html#a558b618265a6c7bf8eed5bd947f3a64f">SG_ASSERT</a>(move == <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgPoint_8h.html#a91bceaeaed14cc1ac24bec79532430e7">SG_PASS</a> || ! <a class="code" href="classGoUctState.html#aea9469fa8b353f891e4b0480f6d8495e" title="Board used for in-tree phase.">m_bd</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#ac23a21aad5b279ff0befa99778d84581">Occupied</a>(move));
<a name="l00121"></a>00121     <span class="comment">// Temporarily switch ko rule to SIMPLEKO to avoid slow full board</span>
<a name="l00122"></a>00122     <span class="comment">// repetition test in GoBoard::Play()</span>
<a name="l00123"></a>00123     <a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoRestoreKoRule.html">GoRestoreKoRule</a> restoreKoRule(<a class="code" href="classGoUctState.html#aea9469fa8b353f891e4b0480f6d8495e" title="Board used for in-tree phase.">m_bd</a>);
<a name="l00124"></a>00124     <a class="code" href="classGoUctState.html#aea9469fa8b353f891e4b0480f6d8495e" title="Board used for in-tree phase.">m_bd</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#a6cae0cf1e43359f95edc5f0d1f148253">Rules</a>().<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoRules.html#a6e42a634edab6c3129ede19a5f50b9f6">SetKoRule</a>(<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoRules.html#ab95a25d594e8f717502159205eb627d9af0c750741212b252de47f2d1193cb094">GoRules::SIMPLEKO</a>);
<a name="l00125"></a>00125     <a class="code" href="classGoUctState.html#aea9469fa8b353f891e4b0480f6d8495e" title="Board used for in-tree phase.">m_bd</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#a277960d5f3fb21a232b1e4c25efec148">Play</a>(move);
<a name="l00126"></a>00126     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgSystem_8h.html#a558b618265a6c7bf8eed5bd947f3a64f">SG_ASSERT</a>(! <a class="code" href="classGoUctState.html#aea9469fa8b353f891e4b0480f6d8495e" title="Board used for in-tree phase.">m_bd</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#a9a551caabec206d9659e3e859fedfeb4">LastMoveInfo</a>(<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/GoBoard_8h.html#a2cd293b3c4ac55f647cec3614c17987ca14b0c2a6f1fea9af50f9d8f5a9fd8110">GO_MOVEFLAG_ILLEGAL</a>));
<a name="l00127"></a>00127     ++<a class="code" href="classGoUctState.html#a3ac9557ea8f5639fec9da4388a4398ee" title="See GameLength().">m_gameLength</a>;
<a name="l00128"></a>00128 }
<a name="l00129"></a>00129 
<a name="l00130"></a><a class="code" href="classGoUctState.html#a50f4b0b8648e3894bd4abc36fb23ae61">00130</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctState.html#a50f4b0b8648e3894bd4abc36fb23ae61" title="Implementation of SgUctSearch::ExecutePlayout.">GoUctState::ExecutePlayout</a>(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgMove_8h.html#ab340c6de81d64e1ff03291b50925defa">SgMove</a> move)
<a name="l00131"></a>00131 {
<a name="l00132"></a>00132     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgSystem_8h.html#a558b618265a6c7bf8eed5bd947f3a64f">SG_ASSERT</a>(<a class="code" href="classGoUctState.html#a2d07f27c64f730d613dd6a8532ecd815">m_isInPlayout</a>);
<a name="l00133"></a>00133     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgSystem_8h.html#a558b618265a6c7bf8eed5bd947f3a64f">SG_ASSERT</a>(move == <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgPoint_8h.html#a91bceaeaed14cc1ac24bec79532430e7">SG_PASS</a> || ! <a class="code" href="classGoUctState.html#a0335d31b29d23b5b6e5927b90c4eb814" title="Board used for playout phase.">m_uctBd</a>.<a class="code" href="classGoUctBoard.html#a4ff2137d7334ecc2b4d303f15fc810d3" title="Check if point is occupied by a stone.">Occupied</a>(move));
<a name="l00134"></a>00134     <a class="code" href="classGoUctState.html#a0335d31b29d23b5b6e5927b90c4eb814" title="Board used for playout phase.">m_uctBd</a>.<a class="code" href="classGoUctBoard.html#a3308ae2c04771591cceb0100efe1403f" title="Play a move for the current player.">Play</a>(move);
<a name="l00135"></a>00135     ++<a class="code" href="classGoUctState.html#a3ac9557ea8f5639fec9da4388a4398ee" title="See GameLength().">m_gameLength</a>;
<a name="l00136"></a>00136 }
<a name="l00137"></a>00137 
<a name="l00138"></a><a class="code" href="classGoUctState.html#ada6cc5c50be06b431599cec3a7a4edab">00138</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctState.html#ada6cc5c50be06b431599cec3a7a4edab">GoUctState::GameStart</a>()
<a name="l00139"></a>00139 {
<a name="l00140"></a>00140     <a class="code" href="classGoUctState.html#a2d07f27c64f730d613dd6a8532ecd815">m_isInPlayout</a> = <span class="keyword">false</span>;
<a name="l00141"></a>00141     <a class="code" href="classGoUctState.html#a3ac9557ea8f5639fec9da4388a4398ee" title="See GameLength().">m_gameLength</a> = 0;
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a><a class="code" href="classGoUctState.html#a78aa3fd3c593902b094cb214b2b96e21">00144</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctState.html#a78aa3fd3c593902b094cb214b2b96e21">GoUctState::StartPlayout</a>()
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146     <a class="code" href="classGoUctState.html#a0335d31b29d23b5b6e5927b90c4eb814" title="Board used for playout phase.">m_uctBd</a>.<a class="code" href="classGoUctBoard.html#a3f76233b2b0ff9ff4fb228310e09b2e6" title="Re-initializes the board from GoBoard position.">Init</a>(<a class="code" href="classGoUctState.html#aea9469fa8b353f891e4b0480f6d8495e" title="Board used for in-tree phase.">m_bd</a>);
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 
<a name="l00149"></a><a class="code" href="classGoUctState.html#a7e4245be8b6453fc9b332ccc749829a1">00149</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctState.html#a7e4245be8b6453fc9b332ccc749829a1">GoUctState::StartPlayouts</a>()
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151     <a class="code" href="classGoUctState.html#a2d07f27c64f730d613dd6a8532ecd815">m_isInPlayout</a> = <span class="keyword">true</span>;
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="classGoUctState.html#a0b4820f9585948eab2966df706bb7ceb">00154</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctState.html#a0b4820f9585948eab2966df706bb7ceb">GoUctState::StartSearch</a>()
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156     <a class="code" href="classGoUctState.html#a762102ef7b7b672d3d79f16b6476a12e">m_synchronizer</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoardSynchronizer.html#afb7f466f40251ee64ca534ac1921123e">UpdateSubscriber</a>();
<a name="l00157"></a>00157 }
<a name="l00158"></a>00158 
<a name="l00159"></a><a class="code" href="classGoUctState.html#a6c732a063dd073e3f148e081faad137a">00159</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctState.html#a6c732a063dd073e3f148e081faad137a">GoUctState::TakeBackInTree</a>(std::size_t nuMoves)
<a name="l00160"></a>00160 {
<a name="l00161"></a>00161     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; nuMoves; ++i)
<a name="l00162"></a>00162         <a class="code" href="classGoUctState.html#aea9469fa8b353f891e4b0480f6d8495e" title="Board used for in-tree phase.">m_bd</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#a043fe4741e8606969db13338491673da">Undo</a>();
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00165"></a><a class="code" href="classGoUctState.html#af80f44c81fe3029f4300fbb858832a45">00165</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctState.html#af80f44c81fe3029f4300fbb858832a45">GoUctState::TakeBackPlayout</a>(std::size_t nuMoves)
<a name="l00166"></a>00166 {
<a name="l00167"></a>00167     <a class="code" href="classGoUctState.html#a3ac9557ea8f5639fec9da4388a4398ee" title="See GameLength().">m_gameLength</a> -= nuMoves;
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="classGoUctSearch.html#ab74db157bbfeab2531253c40fae8845b">00172</a> <a class="code" href="classGoUctSearch.html#ab74db157bbfeab2531253c40fae8845b" title="Constructor.">GoUctSearch::GoUctSearch</a>(<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html">GoBoard</a>&amp; bd, <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctThreadStateFactory.html">SgUctThreadStateFactory</a>* factory)
<a name="l00173"></a>00173     : <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctSearch.html">SgUctSearch</a>(factory, MOVERANGE),
<a name="l00174"></a>00174       m_keepGames(false),
<a name="l00175"></a>00175       m_liveGfxInterval(5000),
<a name="l00176"></a>00176       m_toPlay(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgBlackWhite_8h.html#a455e66a4a6ccc0a446eb2d10814c93a5">SG_BLACK</a>),
<a name="l00177"></a>00177       m_bd(bd),
<a name="l00178"></a>00178       m_root(0),
<a name="l00179"></a>00179       m_liveGfx(<a class="code" href="GoUctSearch_8h.html#aa3cec61c4a01e5e5b04e1e0f2d9a5685a6861f2ab04679eca72f081573b34aaff" title="Don&amp;#39;t print live-gfx information.">GOUCT_LIVEGFX_NONE</a>)
<a name="l00180"></a>00180 {
<a name="l00181"></a>00181     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctSearch.html#aac7cb6dfe731577537b151193c1e9267">SetRaveCheckSame</a>(<span class="keyword">true</span>);
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a><a class="code" href="classGoUctSearch.html#add18018dd88b869cb9a5fbf6930094cf">00184</a> <a class="code" href="classGoUctSearch.html#add18018dd88b869cb9a5fbf6930094cf">GoUctSearch::~GoUctSearch</a>()
<a name="l00185"></a>00185 {
<a name="l00186"></a>00186     <span class="keywordflow">if</span> (<a class="code" href="classGoUctSearch.html#a45098cf0fa26f59d94272d5ee88539b5" title="See SetKeepGames().">m_root</a> != 0)
<a name="l00187"></a>00187         <a class="code" href="classGoUctSearch.html#a45098cf0fa26f59d94272d5ee88539b5" title="See SetKeepGames().">m_root</a>-&gt;<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html#ac2df9beff03be70e165031a13695b02b">DeleteTree</a>();
<a name="l00188"></a>00188     <a class="code" href="classGoUctSearch.html#a45098cf0fa26f59d94272d5ee88539b5" title="See SetKeepGames().">m_root</a> = 0;
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="classGoUctSearch.html#affeb25ab7bdee334779af5739b7c04f1">00191</a> std::string <a class="code" href="classGoUctSearch.html#affeb25ab7bdee334779af5739b7c04f1">GoUctSearch::MoveString</a>(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgMove_8h.html#ab340c6de81d64e1ff03291b50925defa">SgMove</a> move)<span class="keyword"> const</span>
<a name="l00192"></a>00192 <span class="keyword"></span>{
<a name="l00193"></a>00193     <span class="keywordflow">return</span> <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/namespaceSgPointUtil.html#acfac455ce1966e7d9908bf80309d0ad6">SgPointUtil::PointToString</a>(move);
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a><a class="code" href="classGoUctSearch.html#a404f7d23ecfb23b6ebcee84c8acfc327">00196</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctSearch.html#a404f7d23ecfb23b6ebcee84c8acfc327">GoUctSearch::OnSearchIteration</a>(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgUctValue_8h.html#a14d2f4b164799cba5679f82158445cfa">SgUctValue</a> gameNumber,
<a name="l00197"></a>00197                                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> threadId,
<a name="l00198"></a>00198                                     <span class="keyword">const</span> <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/structSgUctGameInfo.html">SgUctGameInfo</a>&amp; info)
<a name="l00199"></a>00199 {
<a name="l00200"></a>00200     <a class="code" href="classGoUctSearch.html#a404f7d23ecfb23b6ebcee84c8acfc327">SgUctSearch::OnSearchIteration</a>(gameNumber, threadId, info);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <span class="keywordflow">if</span> (<a class="code" href="classGoUctSearch.html#ae1bca13178e37e9682241c4b6248bc4a">m_liveGfx</a> != <a class="code" href="GoUctSearch_8h.html#aa3cec61c4a01e5e5b04e1e0f2d9a5685a6861f2ab04679eca72f081573b34aaff" title="Don&amp;#39;t print live-gfx information.">GOUCT_LIVEGFX_NONE</a> &amp;&amp; threadId == 0
<a name="l00203"></a>00203         &amp;&amp; gameNumber &gt; <a class="code" href="classGoUctSearch.html#ac4b384b9c5e0131a9cbe54510c8c1096">m_nextLiveGfx</a>)
<a name="l00204"></a>00204     {
<a name="l00205"></a>00205         <a class="code" href="classGoUctSearch.html#ac4b384b9c5e0131a9cbe54510c8c1096">m_nextLiveGfx</a> = gameNumber + <a class="code" href="classGoUctSearch.html#a9100e842fcbb1bec8b91bbc21284d05e" title="See SetLiveGfxInterval().">m_liveGfxInterval</a>;
<a name="l00206"></a>00206         <a class="code" href="classGoUctSearch.html#a35c88a1293eac4908ef6b0ad929b0055">DisplayGfx</a>();
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208     <span class="keywordflow">if</span> (! <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctSearch.html#a8e900b3b036894bc68847f1f95b0897b">LockFree</a>() &amp;&amp; <a class="code" href="classGoUctSearch.html#a45098cf0fa26f59d94272d5ee88539b5" title="See SetKeepGames().">m_root</a> != 0)
<a name="l00209"></a>00209         AppendGame(<a class="code" href="classGoUctSearch.html#a45098cf0fa26f59d94272d5ee88539b5" title="See SetKeepGames().">m_root</a>, gameNumber, threadId, <a class="code" href="classGoUctSearch.html#a9c54106e0495ad6352c963aae7bea026" title="Color to play.">m_toPlay</a>, info);
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00212"></a><a class="code" href="classGoUctSearch.html#a35c88a1293eac4908ef6b0ad929b0055">00212</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctSearch.html#a35c88a1293eac4908ef6b0ad929b0055">GoUctSearch::DisplayGfx</a>()
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8cpp.html#a4f7aef519ae8e6fcc1399ffee77dd85d">SgDebug</a>() &lt;&lt; <span class="stringliteral">&quot;gogui-gfx:\n&quot;</span>;
<a name="l00215"></a>00215     <span class="keywordflow">switch</span> (<a class="code" href="classGoUctSearch.html#ae1bca13178e37e9682241c4b6248bc4a">m_liveGfx</a>)
<a name="l00216"></a>00216     {
<a name="l00217"></a>00217     <span class="keywordflow">case</span> <a class="code" href="GoUctSearch_8h.html#aa3cec61c4a01e5e5b04e1e0f2d9a5685a3db8a496a615b86b29f4c470e4876d59" title="Print values and counts as in GoUctUtil::GoGuiGfx().">GOUCT_LIVEGFX_COUNTS</a>:
<a name="l00218"></a>00218         <a class="code" href="namespaceGoUctUtil.html#a8a8e9881c7ae7e8f374cfc8ffbf509ee" title="Print information about search as Gfx commands for GoGui.">GoUctUtil::GfxBestMove</a>(*<span class="keyword">this</span>, <a class="code" href="classGoUctSearch.html#a9c54106e0495ad6352c963aae7bea026" title="Color to play.">m_toPlay</a>, <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8cpp.html#a4f7aef519ae8e6fcc1399ffee77dd85d">SgDebug</a>());
<a name="l00219"></a>00219         <a class="code" href="namespaceGoUctUtil.html#a6f13c9d1f3ebd44965269bb63392de69" title="Print the move values as Gfx commands for GoGui.">GoUctUtil::GfxMoveValues</a>(*<span class="keyword">this</span>, <a class="code" href="classGoUctSearch.html#a9c54106e0495ad6352c963aae7bea026" title="Color to play.">m_toPlay</a>, <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8cpp.html#a4f7aef519ae8e6fcc1399ffee77dd85d">SgDebug</a>());
<a name="l00220"></a>00220         <a class="code" href="namespaceGoUctUtil.html#a3b65618fc958e21f2a28d152cfe6b371" title="Print move counts as Gfx commands for GoGui.">GoUctUtil::GfxCounts</a>(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctSearch.html#a543e3447ba3885494014e5bdf99c1673">Tree</a>(), <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8cpp.html#a4f7aef519ae8e6fcc1399ffee77dd85d">SgDebug</a>());
<a name="l00221"></a>00221         <a class="code" href="namespaceGoUctUtil.html#ab638e294fbdd31fd4612424ac60234e5" title="Print information about search as GoGui Gfx commands for text in the status line.">GoUctUtil::GfxStatus</a>(*<span class="keyword">this</span>, <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8cpp.html#a4f7aef519ae8e6fcc1399ffee77dd85d">SgDebug</a>());
<a name="l00222"></a>00222         <span class="keywordflow">break</span>;
<a name="l00223"></a>00223     <span class="keywordflow">case</span> <a class="code" href="GoUctSearch_8h.html#aa3cec61c4a01e5e5b04e1e0f2d9a5685ad5d69eb64fb3e9f7b30ddf5b7e5a1976" title="Show GoGui live graphics with the main variation.">GOUCT_LIVEGFX_SEQUENCE</a>:
<a name="l00224"></a>00224         <a class="code" href="namespaceGoUctUtil.html#a8b8da744d3fc4c251204aeb3021f75e1" title="Print best sequence of search in GoGui live-gfx format.">GoUctUtil::GfxSequence</a>(*<span class="keyword">this</span>, <a class="code" href="classGoUctSearch.html#a9c54106e0495ad6352c963aae7bea026" title="Color to play.">m_toPlay</a>, <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8cpp.html#a4f7aef519ae8e6fcc1399ffee77dd85d">SgDebug</a>());
<a name="l00225"></a>00225         <a class="code" href="namespaceGoUctUtil.html#ab638e294fbdd31fd4612424ac60234e5" title="Print information about search as GoGui Gfx commands for text in the status line.">GoUctUtil::GfxStatus</a>(*<span class="keyword">this</span>, <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8cpp.html#a4f7aef519ae8e6fcc1399ffee77dd85d">SgDebug</a>());
<a name="l00226"></a>00226         <span class="keywordflow">break</span>;
<a name="l00227"></a>00227     <span class="keywordflow">case</span> <a class="code" href="GoUctSearch_8h.html#aa3cec61c4a01e5e5b04e1e0f2d9a5685a6861f2ab04679eca72f081573b34aaff" title="Don&amp;#39;t print live-gfx information.">GOUCT_LIVEGFX_NONE</a>:
<a name="l00228"></a>00228         <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgSystem_8h.html#a558b618265a6c7bf8eed5bd947f3a64f">SG_ASSERT</a>(<span class="keyword">false</span>); <span class="comment">// Should only be called when LiveGfx is enabled</span>
<a name="l00229"></a>00229         <span class="keywordflow">break</span>;
<a name="l00230"></a>00230     }
<a name="l00231"></a>00231     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8cpp.html#a4f7aef519ae8e6fcc1399ffee77dd85d">SgDebug</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00232"></a>00232 }
<a name="l00233"></a>00233 
<a name="l00234"></a><a class="code" href="classGoUctSearch.html#a624730008c282d3b4f64fe38fa245396">00234</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctSearch.html#a624730008c282d3b4f64fe38fa245396">GoUctSearch::OnStartSearch</a>()
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236     <a class="code" href="classGoUctSearch.html#a624730008c282d3b4f64fe38fa245396">SgUctSearch::OnStartSearch</a>();
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     <span class="keywordflow">if</span> (<a class="code" href="classGoUctSearch.html#a45098cf0fa26f59d94272d5ee88539b5" title="See SetKeepGames().">m_root</a> != 0)
<a name="l00239"></a>00239     {
<a name="l00240"></a>00240         <a class="code" href="classGoUctSearch.html#a45098cf0fa26f59d94272d5ee88539b5" title="See SetKeepGames().">m_root</a>-&gt;<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgNode.html#ac2df9beff03be70e165031a13695b02b">DeleteTree</a>();
<a name="l00241"></a>00241         <a class="code" href="classGoUctSearch.html#a45098cf0fa26f59d94272d5ee88539b5" title="See SetKeepGames().">m_root</a> = 0;
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243     <span class="keywordflow">if</span> (<a class="code" href="classGoUctSearch.html#a323b1456dc7dd48df9ee1742f0eceaca" title="See SetKeepGames().">m_keepGames</a>)
<a name="l00244"></a>00244     {
<a name="l00245"></a>00245         <a class="code" href="classGoUctSearch.html#a45098cf0fa26f59d94272d5ee88539b5" title="See SetKeepGames().">m_root</a> = <a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/namespaceGoNodeUtil.html#a83f59d5fcd9a4adb04068a21d67fb49c">GoNodeUtil::CreateRoot</a>(<a class="code" href="classGoUctSearch.html#aed5afbdd13a24c0239d33c59282a3124">m_bd</a>);
<a name="l00246"></a>00246         <span class="keywordflow">if</span> (<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctSearch.html#a8e900b3b036894bc68847f1f95b0897b">LockFree</a>())
<a name="l00247"></a>00247             <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8cpp.html#a73d450433f48385267527d2aeb1f8fbf">SgWarning</a>() &lt;&lt;
<a name="l00248"></a>00248                 <span class="stringliteral">&quot;GoUctSearch: keep games will be ignored&quot;</span>
<a name="l00249"></a>00249                 <span class="stringliteral">&quot; in lock free search\n&quot;</span>;
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251     <a class="code" href="classGoUctSearch.html#a9c54106e0495ad6352c963aae7bea026" title="Color to play.">m_toPlay</a> = <a class="code" href="classGoUctSearch.html#aed5afbdd13a24c0239d33c59282a3124">m_bd</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#a8f26442e14c3cdc06c56c20b49703591">ToPlay</a>(); <span class="comment">// Not needed if SetToPlay() was called</span>
<a name="l00252"></a>00252     <span class="keywordflow">for</span> (<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgBWIterator.html">SgBWIterator</a> it; it; ++it)
<a name="l00253"></a>00253         <a class="code" href="classGoUctSearch.html#a0175f8a0fc912e950bbc4b86e3ecf3d5" title="Stones of position that the current search tree belongs to.">m_stones</a>[*it] = <a class="code" href="classGoUctSearch.html#aed5afbdd13a24c0239d33c59282a3124">m_bd</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#adcedf5dc31a73a965e00e96a088097a0">All</a>(*it);
<a name="l00254"></a>00254     <span class="keywordtype">int</span> size = <a class="code" href="classGoUctSearch.html#aed5afbdd13a24c0239d33c59282a3124">m_bd</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#a616aba99c5f7075be081451d6cefbaf0">Size</a>();
<a name="l00255"></a>00255     <span class="comment">// Limit to avoid very long games if m_simpleKo</span>
<a name="l00256"></a>00256     <span class="keywordtype">int</span> maxGameLength = min(3 * size * size,
<a name="l00257"></a>00257                             <a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/GoBoard_8h.html#accfde8d2c95d56051afaae5e35ebade9">GO_MAX_NUM_MOVES</a> - <a class="code" href="classGoUctSearch.html#aed5afbdd13a24c0239d33c59282a3124">m_bd</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#aafca51e49debbebb8d9a99d5f95989b2">MoveNumber</a>());
<a name="l00258"></a>00258     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctSearch.html#a7f728ae1412704de6beab269b5b3c6bf">SetMaxGameLength</a>(maxGameLength);
<a name="l00259"></a>00259     <a class="code" href="classGoUctSearch.html#af563ee6b2f5219fb848bc849099db79b">m_boardHistory</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoardHistory.html#a979c2c7ec9aff0c5f0752e1560bcec16">SetFromBoard</a>(<a class="code" href="classGoUctSearch.html#aed5afbdd13a24c0239d33c59282a3124">m_bd</a>);
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     <a class="code" href="classGoUctSearch.html#ac4b384b9c5e0131a9cbe54510c8c1096">m_nextLiveGfx</a> = <a class="code" href="classGoUctSearch.html#a9100e842fcbb1bec8b91bbc21284d05e" title="See SetLiveGfxInterval().">m_liveGfxInterval</a>;
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00264"></a><a class="code" href="classGoUctSearch.html#a832b5bcc76ceea53e4080f7e01fcd529">00264</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctSearch.html#a832b5bcc76ceea53e4080f7e01fcd529" title="See SetKeepGames().">GoUctSearch::SaveGames</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; fileName)<span class="keyword"> const</span>
<a name="l00265"></a>00265 <span class="keyword"></span>{
<a name="l00266"></a>00266     <span class="keywordflow">if</span> (<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctSearch.html#a0ac55ec44c4fb9766c40affc55f50b29">MpiSynchronizer</a>()-&gt;IsRootProcess())
<a name="l00267"></a>00267     {
<a name="l00268"></a>00268     <span class="keywordflow">if</span> (<a class="code" href="classGoUctSearch.html#a45098cf0fa26f59d94272d5ee88539b5" title="See SetKeepGames().">m_root</a> == 0)
<a name="l00269"></a>00269         <span class="keywordflow">throw</span> <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgException.html">SgException</a>(<span class="stringliteral">&quot;No games to save&quot;</span>);
<a name="l00270"></a>00270     ofstream out(fileName.c_str());
<a name="l00271"></a>00271     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgGameWriter.html">SgGameWriter</a> writer(out);
<a name="l00272"></a>00272     writer.WriteGame(*<a class="code" href="classGoUctSearch.html#a45098cf0fa26f59d94272d5ee88539b5" title="See SetKeepGames().">m_root</a>, <span class="keyword">true</span>, 0, 1, 19);
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00276"></a><a class="code" href="classGoUctSearch.html#a67b75c72c0e2d66b3b6f22d504fc23c8">00276</a> <span class="keywordtype">void</span> <a class="code" href="classGoUctSearch.html#a67b75c72c0e2d66b3b6f22d504fc23c8" title="See GoUctUtil::SaveTree().">GoUctSearch::SaveTree</a>(std::ostream&amp; out, <span class="keywordtype">int</span> maxDepth)<span class="keyword"> const</span>
<a name="l00277"></a>00277 <span class="keyword"></span>{
<a name="l00278"></a>00278     <a class="code" href="classGoUctSearch.html#a67b75c72c0e2d66b3b6f22d504fc23c8" title="See GoUctUtil::SaveTree().">GoUctUtil::SaveTree</a>(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctSearch.html#a543e3447ba3885494014e5bdf99c1673">Tree</a>(), <a class="code" href="classGoUctSearch.html#aed5afbdd13a24c0239d33c59282a3124">m_bd</a>.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#a616aba99c5f7075be081451d6cefbaf0">Size</a>(), <a class="code" href="classGoUctSearch.html#a0175f8a0fc912e950bbc4b86e3ecf3d5" title="Stones of position that the current search tree belongs to.">m_stones</a>, <a class="code" href="classGoUctSearch.html#a9c54106e0495ad6352c963aae7bea026" title="Color to play.">m_toPlay</a>, out,
<a name="l00279"></a>00279                         maxDepth);
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="classGoUctSearch.html#a026cc8a52b583305dd930c7d5933ce51">00282</a> <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgBlackWhite_8h.html#afd337f4ec449af4cfe657b21993d556d">SgBlackWhite</a> <a class="code" href="classGoUctSearch.html#a026cc8a52b583305dd930c7d5933ce51" title="Color to play at the root node of the last search.">GoUctSearch::ToPlay</a>()<span class="keyword"> const</span>
<a name="l00283"></a>00283 <span class="keyword"></span>{
<a name="l00284"></a>00284     <span class="keywordflow">return</span> <a class="code" href="classGoUctSearch.html#a9c54106e0495ad6352c963aae7bea026" title="Color to play.">m_toPlay</a>;
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00288"></a>00288 
<a name="l00289"></a><a class="code" href="namespaceGoUctSearchUtil.html#a40c3b6d08c80fe2ca45de23d39ec1941">00289</a> <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgPoint_8h.html#a49c23409e7e51c1edc053b56d3dd248c">SgPoint</a> <a class="code" href="namespaceGoUctSearchUtil.html#a40c3b6d08c80fe2ca45de23d39ec1941" title="Checks if move is a bad pass move, if Tromp-Taylor rules are used, and tries to fix it...">GoUctSearchUtil::TrompTaylorPassCheck</a>(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgPoint_8h.html#a49c23409e7e51c1edc053b56d3dd248c">SgPoint</a> move,
<a name="l00290"></a>00290                                               <span class="keyword">const</span> <a class="code" href="classGoUctSearch.html" title="Base class for UCT searches in Go.">GoUctSearch</a>&amp; search)
<a name="l00291"></a>00291 {
<a name="l00292"></a>00292     <span class="keyword">const</span> <a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html">GoBoard</a>&amp; bd = search.<a class="code" href="classGoUctSearch.html#afd964611430f9eae9e41bb6a74984cf3">Board</a>();
<a name="l00293"></a>00293     <span class="keywordtype">bool</span> isFirstPass = (bd.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#a36d012152f29ffcb859c259122d0afe4">GetLastMove</a>() != <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgPoint_8h.html#a91bceaeaed14cc1ac24bec79532430e7">SG_PASS</a>);
<a name="l00294"></a>00294     <span class="keywordtype">bool</span> isTrompTaylorRules = bd.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#a6cae0cf1e43359f95edc5f0d1f148253">Rules</a>().<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoRules.html#ad44ac6cc1c5bd29f3395128265b68a2c">CaptureDead</a>();
<a name="l00295"></a>00295     <span class="keywordflow">if</span> (move != <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgPoint_8h.html#a91bceaeaed14cc1ac24bec79532430e7">SG_PASS</a> || ! isTrompTaylorRules || ! isFirstPass)
<a name="l00296"></a>00296         <span class="keywordflow">return</span> move;
<a name="l00297"></a>00297     <span class="keywordtype">float</span> komi = bd.<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoBoard.html#a6cae0cf1e43359f95edc5f0d1f148253">Rules</a>().<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoRules.html#aa040c02bc271cd8155f4afe305b0a6c4">Komi</a>().<a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/classGoKomi.html#aa01fe8a947bbb7c0fc28e54ed39cc8f3">ToFloat</a>();
<a name="l00298"></a>00298     <span class="keywordtype">float</span> trompTaylorScore = <a class="codeRef" doxygen="go.tags:../go-doc/" href="../go-doc/namespaceGoBoardUtil.html#ae420547de2dbf81be37ed1cd49f79e3f">GoBoardUtil::TrompTaylorScore</a>(bd, komi);
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (search.<a class="code" href="classGoUctSearch.html#a026cc8a52b583305dd930c7d5933ce51" title="Color to play at the root node of the last search.">ToPlay</a>() != <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgBlackWhite_8h.html#a455e66a4a6ccc0a446eb2d10814c93a5">SG_BLACK</a>)
<a name="l00300"></a>00300         trompTaylorScore *= -1;
<a name="l00301"></a>00301     <span class="keyword">const</span> <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctTree.html">SgUctTree</a>&amp; tree = search.<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctSearch.html#a543e3447ba3885494014e5bdf99c1673">Tree</a>();
<a name="l00302"></a>00302     <span class="keyword">const</span> <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctNode.html">SgUctNode</a>&amp; root = tree.<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctTree.html#a565f36ba3215a96b5074b94065bd24a4">Root</a>();
<a name="l00303"></a>00303     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgUctValue_8h.html#a14d2f4b164799cba5679f82158445cfa">SgUctValue</a> value = root.<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctNode.html#ad2a5651c5537284caccdfe3cc437b579">Mean</a>();
<a name="l00304"></a>00304     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgUctValue_8h.html#a14d2f4b164799cba5679f82158445cfa">SgUctValue</a> trompTaylorWinValue = (trompTaylorScore &gt; 0 ? 1 : 0);
<a name="l00305"></a>00305     <span class="keywordflow">if</span> (value &lt; trompTaylorWinValue)
<a name="l00306"></a>00306         <span class="keywordflow">return</span> move;
<a name="l00307"></a>00307     <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8cpp.html#a4f7aef519ae8e6fcc1399ffee77dd85d">SgDebug</a>() &lt;&lt; <span class="stringliteral">&quot;GoUctSearchUtil::TrompTaylorPassCheck: bad pass move value=&quot;</span>
<a name="l00308"></a>00308               &lt;&lt; value &lt;&lt; <span class="stringliteral">&quot; trompTaylorScore=&quot;</span> &lt;&lt; trompTaylorScore &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00309"></a>00309     vector&lt;SgMove&gt; excludeMoves;
<a name="l00310"></a>00310     excludeMoves.push_back(<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgPoint_8h.html#a91bceaeaed14cc1ac24bec79532430e7">SG_PASS</a>);
<a name="l00311"></a>00311     <span class="keyword">const</span> <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctNode.html">SgUctNode</a>* bestChild = search.<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctSearch.html#a469aaeba109c02c4c85391df35e94116">FindBestChild</a>(root, &amp;excludeMoves);
<a name="l00312"></a>00312     <span class="keywordflow">if</span> (bestChild == 0)
<a name="l00313"></a>00313     {
<a name="l00314"></a>00314         <a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/SgDebug_8cpp.html#a4f7aef519ae8e6fcc1399ffee77dd85d">SgDebug</a>() &lt;&lt;
<a name="l00315"></a>00315             <span class="stringliteral">&quot;GoUctSearchUtil::TrompTaylorPassCheck: &quot;</span>
<a name="l00316"></a>00316             <span class="stringliteral">&quot;(no second best move found)\n&quot;</span>;
<a name="l00317"></a>00317         <span class="keywordflow">return</span> move;
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319     <span class="keywordflow">return</span> bestChild-&gt;<a class="codeRef" doxygen="smartgame.tags:../smartgame-doc/" href="../smartgame-doc/classSgUctNode.html#acf9d0e8a1888bdab3120c7422a3d98f3">Move</a>();
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 <span class="comment">//----------------------------------------------------------------------------</span>
</pre></div></div>
</div>
<p>
<hr>
<div style="text-align:right;">
Sun Mar 13 2011 <a href="http://www.doxygen.org/">Doxygen</a> 1.7.1
</div>
</p>
</body>

<!-- Mirrored from fuego.sourceforge.net/fuego-doc-1.1/gouct-doc/GoUctSearch_8cpp_source.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 25 Apr 2012 18:02:59 GMT -->
</html>
